# Quantum Safe Proxy 設定頁面 PRD

## 1. 專案背景與目標

Quantum Safe Proxy（QSP）是一個以安全為核心的 Proxy 系統，負責在現有服務與客戶端之間提供 TLS / Hybrid / PQC 等加密通訊能力。

目前 QSP 的設定主要透過 **設定檔（config file）** 進行，雖然具備高度彈性，但在日常維運與管理上存在以下問題：

- 設定變更需手動編輯檔案，操作成本高且容易出錯
- 管理者難以直觀理解目前實際生效的設定（effective configuration）
- PQC / Hybrid / fallback 等安全相關設定缺乏清楚的可視化與風險提示
- 缺乏設定變更的審計紀錄與版本追蹤
- 設定流程對非核心開發人員不友善

本專案的目標是 **新增一個 Web-based 設定頁面**，在不破壞既有架構與設定模型的前提下，改善 QSP 的可用性、可維護性與操作安全性。

本產品定位為 **管理端功能的 MVP（最小可行改善）**，重點在於「讓既有設定更好用」，而非重新設計整個設定系統。

---

## 2. 使用者故事

- 身為一位 **EDR / QSP 管理者**，我希望能透過網頁查看目前 QSP 實際生效的設定，以便快速理解系統狀態。
- 身為一位 **管理者**，我希望能在網頁上調整 PQC / Hybrid / TLS 相關設定，而不必每次都編輯設定檔。
- 身為一位 **安全工程師**，我希望所有影響安全等級的設定變更都有明確警告與審計紀錄。
- 身為一位 **維運人員**，我希望能清楚知道哪些設定可以即時套用、哪些需要重啟服務。
- 身為一位 **管理者**，我希望能匯出目前的設定作為備份或 Infrastructure-as-Code 使用。

---

## 3. 核心功能需求

### 3.1 設定檢視（Read）

- 系統需提供設定頁面，顯示：
  - 目前實際生效的設定（Resolved / Effective Config）
  - 各設定值的來源（設定檔 / UI / 預設值）
  - 目前 Proxy 的基本運作狀態（例如：TLS 模式統計、近期 handshake 失敗狀態）
- 對於無修改權限的使用者，設定頁面應為唯讀模式。

---

### 3.2 設定修改（Write）

- 系統需允許使用者透過 UI 修改 QSP 設定，包含但不限於：
  - TLS / Hybrid / PQC 模式策略
  - 是否允許 fallback
  - passthrough 模式
  - 與 Proxy 行為相關的 timeout / policy 設定
- 所有修改必須經過伺服器端驗證（型別、範圍、相容性、安全約束）。
- 影響安全等級的設定（如允許 classical TLS、啟用 fallback）必須：
  - 明確顯示風險提示
  - 要求使用者明確確認
  - 禁止靜默降級（no silent downgrade）

---

### 3.3 設定模型與一致性

- 系統需定義 **單一 ResolvedConfig** 作為執行時行為的唯一依據。
- UI 與設定檔需能同時存在，並具備明確、可預期的優先順序。
- ResolvedConfig 的結構與欄位應以現有設定模型為基礎，不因 UI 導入而重新設計。
- 系統需能顯示：
  - 目前使用中的設定
  - 尚未套用的變更
  - 變更前後的差異（diff）

---

### 3.4 套用方式（Apply Model）

- 系統需清楚區分：
  - 可即時套用（hot-reload）的設定
  - 需重啟服務才能生效的設定
- UI 必須明確告知使用者套用方式與影響範圍。
- 不允許在未告知的情況下自動重啟或套用高風險設定。

---

### 3.5 審計與版本管理

- 每一次設定變更都必須記錄審計資訊，包含：
  - 操作者身分
  - 變更時間
  - 變更內容（before / after）
  - 套用結果
- 系統需維護設定版本號，並至少支援回復到前一版本。

---

### 3.6 匯出與匯入

- 系統需支援：
  - 匯出目前設定為檔案（JSON / YAML）
  - 匯入設定檔進行「預覽與驗證」
- 匯入設定不得自動套用，必須經過明確確認。

---

## 4. 非功能需求

### 4.1 安全性

- 設定 API 必須具備身分驗證與授權控管。
- 不同角色需具備不同權限（例如：只讀 / 可編輯 / 安全管理者）。
- 所有設定變更需可被追蹤與審計。

---

### 4.2 可測試性與穩定性

- 設定驗證邏輯需可獨立測試。
- 設定套用流程需具備整合測試。
- 不應因設定頁面導入而影響既有 Proxy 穩定性。

---

### 4.3 避免過度設計（明確聲明）

- 本專案不目標於建立通用設定平台。
- 不提前設計未來尚未存在的設定類型。
- 不引入不必要的抽象層、DSL 或 plugin 系統。
- 所有設計應以「改善既有流程」為優先。

---

## 5. 成功標準

- 管理者能安全且直覺地管理 QSP 設定。
- PQC / Hybrid / TLS 相關設定的行為清楚、可解釋、可審計。
- 設定流程比現行方式更簡單，而非更複雜。
- 專案未引入不必要的架構與抽象。

